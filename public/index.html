<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Servidor backend</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
			crossorigin="anonymous"
		/>

		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/base16/brewer.min.css"
			integrity="sha512-D7LJSDa4DnNoW3XjAUYmtldC+oWiqsrU4wy0lW2ZGwQUXdBlo+/doY8UFrvZcccxkNAHtLXZubg7e3nRsavkqA=="
			crossorigin="anonymous"
			referrerpolicy="no-referrer"
		/>
	</head>
	<body>
		<div class="container">
			<div>
				<h1 class="d-flex justify-content-center">Formulario de prueba</h1>
			</div>
			<div
				class="col-4 offset-4 justify-content-center border border-secondary border-3 rounded p-3 bg-color"
			>
				<h3 class="text-center">Seleccione metodo a usar:</h3>
				<div class="form-check">
					<input
						class="form-check-input"
						type="radio"
						name="METODO"
						id="prods"
						value="prods"
						checked
					/>
					<label class="form-check-label" for="prods"> TRAER TODOS LOS PRODUCTOS </label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="radio" name="METODO" id="GET" value="get" />
					<label class="form-check-label" for="GET"> GET </label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="radio" name="METODO" id="POST" value="post" />
					<label class="form-check-label" for="POST"> POST </label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="radio" name="METODO" id="PUT" value="put" />
					<label class="form-check-label" for="PUT"> PUT</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="radio" name="METODO" id="DELETE" value="delete" />
					<label class="form-check-label" for="DELETE"> DELETE </label>
				</div>

				<div class="mt-3"
					><button class="btn btn-outline-info" id="confirmar">Confirmar</button></div
				>
			</div>

			<div id="acciones"> </div>
			<div id="resultado"> </div>
		</div>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
			crossorigin="anonymous"
		></script>
		<script>
			const boton = document.querySelector("#confirmar");
			const acciones = document.querySelector("#acciones");
			const resultado = document.querySelector("#resultado");
			boton.onclick = () => {
				let elegido = document.querySelector("input[name=METODO]:checked").value;

				switch (elegido) {
					case "prods":
						acciones.innerHTML = "";
						fetch("/api/productos/")
							.then((resp) => resp.json())
							.then((res) => JSON.stringify(res, undefined, 2))
							.then((data) => {
								resultado.innerHTML = `
<pre>
<code class="json border border-3 border-danger">
${data}
</code>
</pre>`;
								hljs.highlightAll();
							});
						break;

					case "get":
						resultado.innerHTML = "";
						acciones.innerHTML = `
					<div class="col-4 offset-4 justify-content-center border border-secondary border-3 rounded p-3 bg-color mt-3">
					<h3 class="text-center">Ingresar ID de producto a buscar:</h3>
					<label for="inputID" class="form-label">ID de producto</label>
					<input type="number" class="form-control" id="inputID" />
					<div class="mt-3"><button class="btn btn-outline-info" id="buscar">Buscar</button></div>
					</div>`;
						const buscar = document.querySelector("#buscar");
						buscar.onclick = () => {
							const prodID = document.querySelector("#inputID").value;
							fetch(`/api/productos/${prodID}`)
								.then((resp) => resp.json())
								.then((res) => JSON.stringify(res, undefined, 2))
								.then((data) => {
									acciones.innerHTML = "";
									resultado.innerHTML = `
<pre>
<code class="json border border-3 border-danger">
${data}
</code>
</pre>`;
									hljs.highlightAll();
								});
						};
						break;

					case "post":
						resultado.innerHTML = "";
						acciones.innerHTML = `
					<div class="col-4 offset-4 justify-content-center border border-secondary border-3 rounded p-3 bg-color mt-3">
					<h3 class="text-center">Ingresar DATOS del nuevo producto:</h3>
					<label for="nombre" class="form-label">Nombre de producto</label>
					<input type="text" class="form-control" id="nombre" />
					<label for="price" class="form-label">Precio de producto</label>
					<input type="number" class="form-control" id="price" />
					<label for="thumbnail" class="form-label">Thumbnail de producto</label>
					<input type="text" class="form-control" id="thumbnail" />
					<div class="mt-3"><button class="btn btn-outline-info" id="agregar">Agregar</button></div>
					</div>`;
						const agregar = document.querySelector("#agregar");
						agregar.onclick = () => {
							const nombre = document.querySelector("#nombre").value;
							const price = document.querySelector("#price").value;
							const thumbnail = document.querySelector("#thumbnail").value;
							fetch(`/api/productos/`, {
								headers: {
									Accept: "application/json",
									"Content-Type": "application/json",
								},
								method: "POST",
								body: JSON.stringify({ nombre, price, thumbnail }),
							})
								.then((resp) => resp.json())
								.then((res) => JSON.stringify(res, undefined, 2))
								.then((data) => {
									acciones.innerHTML = "";
									resultado.innerHTML = `
<pre>
<code class="json border border-3 border-danger">
"producto creado":
${data}
</code>
</pre>`;
									hljs.highlightAll();
								});
						};
						break;

					case "put":
						resultado.innerHTML = "";
						acciones.innerHTML = `
					<div class="col-4 offset-4 justify-content-center border border-secondary border-3 rounded p-3 bg-color mt-3">
					<h3 class="text-center">Ingresar DATOS para actualizar el producto:</h3>
					<h4 class="text-center">Solo se cambiaran los datos que esten rellenados</h4>
					<label for="IDprod" class="form-label">ID del producto a cambiar</label>
					<input type="text" class="form-control" id="IDprod"/>
					<label for="nombre" class="form-label">Nuevo nombre de producto</label>
					<input type="text" class="form-control" id="nombre" />
					<label for="price" class="form-label">Nuevo precio de producto</label>
					<input type="number" class="form-control" id="price" />
					<label for="thumbnail" class="form-label">Nuevo thumbnail de producto</label>
					<input type="text" class="form-control" id="thumbnail" />
					<div class="mt-3"><button class="btn btn-outline-info" id="actualizar">Actualizar</button></div>
					</div>`;
						const actualizar = document.querySelector("#actualizar");
						actualizar.onclick = () => {
							const IDprod = document.querySelector("#IDprod").value;
							const nombre = document.querySelector("#nombre").value;
							const price = document.querySelector("#price").value;
							const thumbnail = document.querySelector("#thumbnail").value;
							let prodActualizado = {};
							nombre.length > 0 && (prodActualizado.title = nombre);
							price.length > 0 && (prodActualizado.price = price);
							thumbnail.length > 0 && (prodActualizado.thumbnail = thumbnail);
							console.log(prodActualizado);
							fetch(`/api/productos/${IDprod}`, {
								headers: {
									Accept: "application/json",
									"Content-Type": "application/json",
								},
								method: "PUT",
								body: JSON.stringify(prodActualizado),
							})
								.then((resp) => resp.json())
								.then((res) => JSON.stringify(res, undefined, 2))
								.then((data) => {
									acciones.innerHTML = "";
									resultado.innerHTML = `
<pre>
<code class="json border border-3 border-danger">
"producto actualizado a":
${data}
</code>
</pre>`;
									hljs.highlightAll();
								});
						};
						break;

					case "delete":
						resultado.innerHTML = "";
						acciones.innerHTML = `
					<div class="col-4 offset-4 justify-content-center border border-secondary border-3 rounded p-3 bg-color mt-3">
					<h3 class="text-center">Ingresar ID de producto a eliminar:</h3>
					<label for="inputID" class="form-label">ID de producto</label>
					<input type="number" class="form-control" id="inputID" />
					<div class="mt-3"><button class="btn btn-outline-info" id="eliminar">Eliminar</button></div>
					</div>`;
						const eliminar = document.querySelector("#eliminar");
						eliminar.onclick = () => {
							const prodID = document.querySelector("#inputID").value;
							fetch(`/api/productos/${prodID}`, {
								method: "DELETE",
							})
								.then((resp) => resp.json())
								.then((res) => JSON.stringify(res, undefined, 2))
								.then((data) => {
									acciones.innerHTML = "";
									resultado.innerHTML = `
<pre>
<code class="json border border-3 border-danger">
${data}
</code>
</pre>`;
									hljs.highlightAll();
								});
						};
						break;

					default:
						console.error("seleccion de metodo no encontrada.");
						break;
				}
			};
		</script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
	</body>

	<style>
		html {
			height: 100%;
		}
		body {
			background-color: #65b9f4;
			background-size: cover;
			background-image: url("./public/fondo.png");
			background-position: center center;
			background-repeat: no-repeat;
		}

		.bg-color {
			background-color: chocolate;
		}
	</style>
</html>
